### ===========================================
### ALSABA Backend - API Endpoints Test File
### ===========================================
### Utilisez cette extension VS Code : "REST Client"
### Ou IntelliJ/PyCharm avec "HTTP Client"
### ===========================================

### Variables globales

@baseUrl = http://localhost:8000/api
@contentType = application/json

### Variables d'authentification (√† remplir apr√®s login)
@accessToken = VOTRE_ACCESS_TOKEN_ICI
@refreshToken = VOTRE_REFRESH_TOKEN_ICI

### ===========================================
### üîì ENDPOINTS PUBLICS (Sans authentification)
### ===========================================

### -------------------------------------------
### 1. V√©rifier si un num√©ro de t√©l√©phone existe
### -------------------------------------------
# @name checkPhone
POST {{baseUrl}}/accounts/check-phone/
Content-Type: {{contentType}}

{
    "phone_number": "+221781234567",
    "country_code": "SN"
}

### -------------------------------------------
### 2. Authentification par t√©l√©phone (Login/Register)
### Cr√©e un compte si le num√©ro n'existe pas
### Envoie un OTP pour v√©rification
### -------------------------------------------
# @name phoneAuth
POST {{baseUrl}}/accounts/auth/
Content-Type: {{contentType}}

{
    "phone_number": "+221781234567",
    "country_code": "SN"
}

### -------------------------------------------
### 3. V√©rifier l'OTP et obtenir les tokens JWT
### Utilisez le code OTP re√ßu (ou consultez debug/otps/)
### -------------------------------------------
# @name verifyOTP
POST {{baseUrl}}/accounts/verify-otp/
Content-Type: {{contentType}}

{
    "phone_number": "+221781234567",
    "otp": "123456"
}

### -------------------------------------------
### 4. üîß DEBUG - Voir tous les OTP actifs
### ‚ö†Ô∏è √Ä d√©sactiver en production !
### -------------------------------------------
# @name debugOTPs
GET {{baseUrl}}/accounts/debug/otps/
Content-Type: {{contentType}}


### ===========================================
### üîê ENDPOINTS PROT√âG√âS (Authentification requise)
### ===========================================
### ‚ö†Ô∏è Remplacez @accessToken par le token re√ßu de verify-otp

### -------------------------------------------
### 5. R√©cup√©rer le profil utilisateur
### -------------------------------------------
# @name getProfile
GET {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

### -------------------------------------------
### 6. Mettre √† jour le profil (PATCH - partiel)
### -------------------------------------------
# @name updateProfile
PATCH {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "first_name": "Salim",
    "last_name": "Diallo",
    "email": "salim@example.com"
}

### -------------------------------------------
### 7. Mettre √† jour le profil - Seulement le pr√©nom
### -------------------------------------------
# @name updateFirstName
PATCH {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "first_name": "Nouveau Pr√©nom"
}

### -------------------------------------------
### 8. Mettre √† jour le profil - Seulement l'email
### -------------------------------------------
# @name updateEmail
PATCH {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "email": "nouveau@email.com"
}


### ===========================================
### üìÑ KYC - V√âRIFICATION D'IDENTIT√â
### ===========================================

### -------------------------------------------
### 9. R√©cup√©rer les documents KYC de l'utilisateur
### -------------------------------------------
# @name getKYCDocuments
GET {{baseUrl}}/accounts/kyc/submit/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

### -------------------------------------------
### 10. Soumettre un document KYC (version test sans images)
### document_type: "passport", "national_id", "driver_license"
### -------------------------------------------
# @name submitKYC
POST {{baseUrl}}/accounts/kyc/submit/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "document_type": "national_id"
}

### -------------------------------------------
### 11. Soumettre KYC avec passeport
### -------------------------------------------
# @name submitKYCPassport
POST {{baseUrl}}/accounts/kyc/submit/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "document_type": "passport"
}

### -------------------------------------------
### 12. Soumettre KYC avec permis de conduire
### -------------------------------------------
# @name submitKYCDriverLicense
POST {{baseUrl}}/accounts/kyc/submit/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "document_type": "driver_license"
}

### -------------------------------------------
### 13. V√©rifier le statut KYC
### -------------------------------------------
# @name getKYCStatus
GET {{baseUrl}}/accounts/kyc/status/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}


### ===========================================
### üë§ GESTION DU COMPTE
### ===========================================

### -------------------------------------------
### 14. Supprimer/D√©sactiver le compte
### -------------------------------------------
# @name deleteAccount
DELETE {{baseUrl}}/accounts/delete-account/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "confirmation": "DELETE MY ACCOUNT",
    "refresh_token": "{{refreshToken}}"
}


### ===========================================
### üîÑ SC√âNARIOS DE TEST COMPLETS
### ===========================================

### -------------------------------------------
### SC√âNARIO 1 : Inscription compl√®te d'un nouvel utilisateur
### -------------------------------------------
### √âtape 1 : V√©rifier si le num√©ro existe
# @name scenario1_step1
POST {{baseUrl}}/accounts/check-phone/
Content-Type: {{contentType}}

{
    "phone_number": "+221771234568",
    "country_code": "SN"
}

### √âtape 2 : Initier l'authentification (cr√©er compte + envoyer OTP)
# @name scenario1_step2
POST {{baseUrl}}/accounts/auth/
Content-Type: {{contentType}}

{
    "phone_number": "+221771234568",
    "country_code": "SN"
}

### √âtape 3 : R√©cup√©rer l'OTP en mode debug
# @name scenario1_step3
GET {{baseUrl}}/accounts/debug/otps/

### √âtape 4 : V√©rifier l'OTP (remplacez par le vrai code)
# @name scenario1_step4
POST {{baseUrl}}/accounts/verify-otp/
Content-Type: {{contentType}}

{
    "phone_number": "+221771234568",
    "otp": "REMPLACER_PAR_OTP_REEL"
}

### -------------------------------------------
### SC√âNARIO 2 : Utilisateur existant qui se reconnecte
### -------------------------------------------
### √âtape 1 : Authentification
# @name scenario2_step1
POST {{baseUrl}}/accounts/auth/
Content-Type: {{contentType}}

{
    "phone_number": "+221781234568",
    "country_code": "SN"
}

### √âtape 2 : R√©cup√©rer l'OTP
# @name scenario2_step2
GET {{baseUrl}}/accounts/debug/otps/

### -------------------------------------------
### SC√âNARIO 3 : Compl√©ter le profil apr√®s inscription
### -------------------------------------------
### Utilisez le token obtenu apr√®s verify-otp

# @name scenario3_completeProfile
PATCH {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "first_name": "Salim",
    "last_name": "Diallo",
    "email": "salim.diallo@alsaba.com"
}


### ===========================================
### ‚ùå TESTS D'ERREURS (Validation)
### ===========================================

### -------------------------------------------
### Test : Num√©ro de t√©l√©phone invalide
### -------------------------------------------
# @name errorInvalidPhone
POST {{baseUrl}}/accounts/auth/
Content-Type: {{contentType}}

{
    "phone_number": "123",
    "country_code": "SN"
}

### -------------------------------------------
### Test : OTP incorrect
### -------------------------------------------
# @name errorWrongOTP
POST {{baseUrl}}/accounts/verify-otp/
Content-Type: {{contentType}}

{
    "phone_number": "+221781234567",
    "otp": "000000"
}

### -------------------------------------------
### Test : Acc√®s sans token (devrait retourner 401)
### -------------------------------------------
# @name errorNoToken
GET {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}

### -------------------------------------------
### Test : Token invalide (devrait retourner 401)
### -------------------------------------------
# @name errorInvalidToken
GET {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer invalid_token_here

### -------------------------------------------
### Test : Type de document KYC invalide
### -------------------------------------------
# @name errorInvalidKYCType
POST {{baseUrl}}/accounts/kyc/submit/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "document_type": "invalid_type"
}

### -------------------------------------------
### Test : Email d√©j√† utilis√©
### -------------------------------------------
# @name errorDuplicateEmail
PATCH {{baseUrl}}/accounts/profile/
Content-Type: {{contentType}}
Authorization: Bearer {{accessToken}}

{
    "email": "email.deja.utilise@example.com"
}


### ===========================================
### üîß ADMIN - Django Admin
### ===========================================

### -------------------------------------------
### Acc√©der √† l'interface admin (ouvrir dans navigateur)
### URL: http://localhost:8000/admin/
### -------------------------------------------


### ===========================================
### üìù NOTES
### ===========================================
###
### 1. WORKFLOW D'AUTHENTIFICATION:
###    check-phone ‚Üí auth ‚Üí debug/otps ‚Üí verify-otp ‚Üí [token obtenu]
###
### 2. TYPES DE DOCUMENTS KYC:
###    - "passport"
###    - "national_id"
###    - "driver_license"
###
### 3. STATUTS KYC:
###    - "unverified" : Non v√©rifi√©
###    - "pending"    : En attente de v√©rification
###    - "verified"   : V√©rifi√© avec succ√®s
###    - "rejected"   : Rejet√©
###
### 4. CODES DE PAYS SUPPORT√âS:
###    - SN (S√©n√©gal)
###    - CI (C√¥te d'Ivoire)
###    - ML (Mali)
###    - etc.
###
### ===========================================
